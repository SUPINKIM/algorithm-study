# Git의 동작 원리

1. Git 관련 용어

- 로컬 : Working Directory(Working Copy)

  - 실제 위치 : 프로젝트 폴더
  - 현재 프로젝트 폴더에 존재하는 파일들 그 자체를 의미한다.

- 인덱스(Index) : Staging Area = Cache

  - 실제 위치 : 프로젝트 폴더 하위 .git/index 파일
  - 개념적으로는 커밋이 이뤄질 준비가 된 파일의 내용들이 위치하는 영역이며, 실제로는 하나의 파일로서 존재한다. 로컬에 변동 사항이 생겼을 경우, git add 명령어를 수행하면 해당 변동 사항을 인덱스 영역에 반영시킬 수 있다. 참고로, 인덱스 파일(.git/index)에는 커밋이 이뤄질 준비가 된 파일의 내용들 각각에 대하여 그 파일명과 해당 파일의 내용을 담고 있는 Blob 파일의 주소가 기록된다.

- 저장소(Repository)

  - 실제 위치 : 프로젝트 폴더 하위 .git/objects/ 폴더
  - 깃이 버전 관리를 하기 위해 필요로 하는 데이터들을 저장하는 곳이다. 대표적으로, 버전 관리를 시작한 시점부터 현재 시점까지 관리해 온 여러 버전들에 해당하는 파일들의 내용이 Blob 파일로서 이곳에 저장되어 있다. 이곳에 저장된 파일들을 특별히 오브젝트 파일이라고 부르며, Blob 파일도 오브젝트 파일의 한 종류이다.

- 오브젝트 파일

  - 오브젝트 파일이란 .git/objects/ 폴더에 존재하는 파일을 가리키며, 다음과 같이 분류된다.

  - Blob 파일 : 버전 관리하는 파일들 각각의 내용은 깃의 저장소에서 Blob 파일의 형태로 저장된다. 파일의 내용에 SHA1이라는 해싱 기법을 적용하여 Blob 파일의 이름을 얻어내기 때문에, 내용이 같은 파일들은 모두 하나의 Blob 파일로서 저장된다. 이러한 원리로 깃은 여러 버전에 걸쳐 존재하는 파일들의 내용을 중복 없이 관리할 수 있게 된다.

  - Commit 파일 : 하나의 버전을 생성한다는 것은 하나의 Commit 파일을 만드는 것을 의미한다. Commit 파일은 하나의 Tree 파일을 가리키게 되어 있다. 이 파일에는 가리키고 있는 Tree 파일의 주소와 직전 버전에 해당하는 Commit 파일의 주소가 기록된다.

  - Tree 파일 : 커밋 시점의 파일들 각각에 대해 그 파일명과 해당 파일의 내용을 담고 있는 Blob 파일의 주소(이름)가 기록된다. 인덱스 파일(.git/index)과 성격이 유사하다.

  - Tag 파일

2. Git 브랜치

- HEAD

  - 실제 위치 : .git/HEAD
  - 현재 체크아웃 되어 있는 브랜치의 포인터를 가리키는 포인터이다. 브랜치의 포인터가 아닌, 일반적인 Commit 파일을 가리키게 할 수도 있다.(이런 경우 detached HEAD라고 표현된다.)

- 브랜치 포인터
  - .git/refs/heads/{브랜치명}
  - 해당 브랜치의 가장 최신 Commit 파일을 가리키는 포인터이다.

3. Git 용어

- Repository : 스테이지에서 대기하고 있던 파일들을 버전으로 만들어 저장하는 곳이다.

  - 원격 저장소와 로컬 저장소 두 종류의 저장소를 제공한다.

- 로컬 저장소 : 스테이지 내용은 .git/index 파일에 저장되고, 저장소의 내용은 .git/HEAD 파일에 저장된다.

- SnapShot : 특정 시점에서의 파일, 폴더 또는 워크스페이스의 상태를 의미

  - 스냅샷을 통해 특정 시점에 어떤 파일에 어떤 내용이 기록되어 있었는지, 폴더 구조는 어떠했는지, 어떤 파일이 존재했는지 등 저장소의 모든 정보를 확인할 수 있다.

  * Git에서는 새로운 버전을 기록하기 위한 명령인 커밋(commit)을 실행하면 스냅샷이 저장된다.

  - 개발자는 작업 디렉토리에 있는 파일을 수정
  - 수정된 파일을 모아 정리하며 만든 Snapshot을 staging 디렉토리에 추가하고 저장
  - GIT 디렉토리에 저장 (Staging 디렉토리에 저장된 파일을 앞으로 영구 불변의 상태를 유지하는 SnapShot으로서 git 디렉토리에 저장하는 것)

4. GIT 주요 명령어

- git add <파일명> : 인덱스의 내용과 비교했을 때 로컬에서 변동된 사항을 인덱스에 반영시키는 명령어이다. 예를 들어 새로 생성된 파일, 혹은 수정/삭제된 기존 파일이 add 명령의 대상이 된다. <파일명> 대신 . 기호를 사용하면 로컬의 현재 디렉토리에서 add 명령의 대상이 되는 파일들 전부 인덱스에 반영한다.

- git status : 로컬의 내용과 인덱스의 내용을 비교하여 add 명령의 대상이 되는 파일들의 목록을 표시해주고, 인덱스의 내용과 최신 커밋의 Tree 파일 내용을 비교하여 commit 명령의 대상이 되는 파일들의 목록을 표시해주는 명령어이다. 로컬의 내용, 인덱스의 내용, 최신 커밋의 Tree 파일의 내용이 모두 같다면 'nothing to commit'을 출력해준다.

5. git reset & git checkout

- git reset : 브랜치 포인터를 지정된 commit 파일을 가리키도록 바꾼다.

  - --soft 옵션 : 브랜치 포인터만 바꾼다. (로컬 및 인덱스 유지)
  - --mixed 옵션 : 브랜치 포인터 뿐만 아니라 인덱스까지 바꾼다. (로컬 유지)
  - --hard 옵션 : 브랜치 포인터 뿐만 아니라 인덱스와 로컬까지 바꾼다.

- git checkout : HEAD를 지정된 브랜치의 포인터를 가리키도록 바꾼다.

- git merge : 해당 브랜치의 내용을 가져와 현재 체크아웃 되어 있는 브랜치와 병합시켜 새로운 commit 파일을 생성하고, 현재 브랜치의 포인터를 새로운 commit 파일을 가리키도록 바꾼다.

  - \*\* 단, 공통 조상 commit 파일과 현재 브랜치의 commit 파일이 완전히 같은 경우에는 commit 파일이 새로 생성되지 않고(새로 생성되게 옵션을 줄 수는 있음) 현재 브랜치의 포인터만 옮겨주는 Fast-Forward 병합이 이루어진다.

---

🙏 참고 자료

> [[Git] 내부 동작 원리에 대한 이해](https://it-eldorado.tistory.com/4)

> [[GIT] git 개념 & 원리 (그림으로 알기 쉽게 비유)](https://inpa.tistory.com/entry/GIT-⚡%EF%B8%8F-개념-원리-쉽게이해#)

---

✅ 더 공부해야 할 것들
